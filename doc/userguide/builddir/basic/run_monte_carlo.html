

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Monte Carlo simulations &mdash; icet  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/logo.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_styling.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analyze Monte Carlo simulations" href="analyze_monte_carlo.html" />
    <link rel="prev" title="Analyzing ECIs" href="analyze_ecis.html" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@MagicMaterials" />
    <meta name="twitter:image" content="https://icet.materialsmodeling.org/_static/logo-small.png" />
    <meta property="og:title" content="icet" />
    <meta property="og:description" content="A Pythonic approach to cluster expansions." />
    <meta property="og:image" content="https://icet.materialsmodeling.org/_static/logo-2x1.png" />


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> icet
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Main</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#building-a-cluster-expansion">Building a cluster expansion</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#sampling-a-cluster-expansion">Sampling a cluster expansion</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Monte Carlo simulations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analyze_monte_carlo.html">Analyze Monte Carlo simulations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced topics</a></li>
</ul>
<p class="caption"><span class="caption-text">Function reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moduleref_icet/index.html"><strong class="program">icet</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../moduleref_mchammer/index.html"><strong class="program">mchammer</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreref/index.html">Core components</a></li>
</ul>
<p class="caption"><span class="caption-text">Backmatter</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">icet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div style="text-align: right;">
<a href="https://gitlab.com/materials-modeling/icet" target="_blank">gitlab/icet</a>
| <a href="https://materialsmodeling.org/software" target="_blank">materialsmodeling.org/software</a>
| <a href=../genindex.html>index</a>
| <a href=../py-modindex.html>modules</a>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="monte-carlo-simulations">
<span id="index-0"></span><h1>Monte Carlo simulations<a class="headerlink" href="#monte-carlo-simulations" title="Permalink to this headline">¶</a></h1>
<p>We are now in a position to carry out a series of Monte Carlo (MC) simulations
to sample the cluster expansion model that was constructed and validated in the
previous steps. To set up the simulation we first construct a supercell and
initialize an associated calculator by combining <a class="reference internal" href="construct_cluster_expansion.html#tutorial-construct-cluster-expansion"><span class="std std-ref">our cluster expansion
model</span></a> with the supercell.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ce</span> <span class="o">=</span> <span class="n">ClusterExpansion</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mixing_energy.ce&#39;</span><span class="p">)</span>
<span class="n">chemical_symbols</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">cluster_space</span><span class="o">.</span><span class="n">chemical_symbols</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="n">make_supercell</span><span class="p">(</span><span class="n">ce</span><span class="o">.</span><span class="n">cluster_space</span><span class="o">.</span><span class="n">primitive_structure</span><span class="p">,</span>
                       <span class="mi">3</span><span class="o">*</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="n">ClusterExpansionCalculator</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">ce</span><span class="p">)</span>

</pre></div>
</div>
<p>In this example the sampling will be carried out in the semi-grand canonical
(SGC) ensemble. To this end, we set up a <a class="reference internal" href="../moduleref_mchammer/ensembles.html#sgc"><span class="std std-ref">SGC ensemble object</span></a>
object and loop over both temperatures and chemical potential differences.</p>
<p>We carry out a rather long MC run, anticipating that the analysis will
only include the latter part of the simulation after equilibration.
After the run the results are written to file (in the form of a
<a class="reference internal" href="../moduleref_mchammer/data_container.html#data-container"><span class="std std-ref">DataContainer</span></a> object). The latter will be used
in the next step to analyze the runs. Note that the ensemble object is
only initialized once for each temperature. Thereby the configuration
evolves gradually and the period needed for equilibration is
shortened.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">temperature</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">]:</span>

    <span class="c1"># Initialize MC ensemble</span>
    <span class="c1"># TODO: remove chemical_potentials once possible</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">SemiGrandCanonicalEnsemble</span><span class="p">(</span>
        <span class="n">calculator</span><span class="o">=</span><span class="n">calculator</span><span class="p">,</span>
        <span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">,</span>
        <span class="n">ensemble_data_write_interval</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">chemical_potentials</span><span class="o">=</span><span class="p">{</span><span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">0</span><span class="p">})</span>

    <span class="c1"># Evolve configuration through the entire composition range</span>
    <span class="k">for</span> <span class="n">dmu</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">):</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">chemical_potentials</span> <span class="o">=</span> <span class="p">{</span><span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">dmu</span><span class="p">}</span>

        <span class="n">mc</span><span class="o">.</span><span class="n">reset_data_container</span><span class="p">()</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">number_of_trial_steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># TODO: change the next line (and the tutorial) once mc.data_container</span>
        <span class="c1"># is writable</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">data_container</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sgc-T{}-dmu{:.3f}.dc&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dmu</span><span class="p">))</span>
</pre></div>
</div>
<p>On an Intel i7-950 CPU the set up of the calculator takes about 10 seconds,
whereas the Monte Carlo simulation takes about 0.2 seconds per MC trial step.</p>
<div class="section" id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<div class="toggle docutils container">
<div class="header docutils container">
The complete source code is available in
<code class="docutils literal"><span class="pre">tutorial/basic/5_run_monte_carlo.py</span></code></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">make_supercell</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">arange</span><span class="p">,</span> <span class="n">array</span>

<span class="kn">from</span> <span class="nn">icet</span> <span class="kn">import</span> <span class="n">ClusterExpansion</span>
<span class="kn">from</span> <span class="nn">mchammer.calculators</span> <span class="kn">import</span> <span class="n">ClusterExpansionCalculator</span>
<span class="kn">from</span> <span class="nn">mchammer.ensembles</span> <span class="kn">import</span> <span class="n">SemiGrandCanonicalEnsemble</span>

<span class="c1"># step 1: set up the structure to simulate and the calculator</span>
<span class="n">ce</span> <span class="o">=</span> <span class="n">ClusterExpansion</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mixing_energy.ce&#39;</span><span class="p">)</span>
<span class="n">chemical_symbols</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">cluster_space</span><span class="o">.</span><span class="n">chemical_symbols</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="n">make_supercell</span><span class="p">(</span><span class="n">ce</span><span class="o">.</span><span class="n">cluster_space</span><span class="o">.</span><span class="n">primitive_structure</span><span class="p">,</span>
                       <span class="mi">3</span><span class="o">*</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="n">ClusterExpansionCalculator</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">ce</span><span class="p">)</span>

<span class="c1"># step 2: carry out Monte Carlo simulations</span>
<span class="k">for</span> <span class="n">temperature</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">]:</span>

    <span class="c1"># Initialize MC ensemble</span>
    <span class="c1"># TODO: remove chemical_potentials once possible</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">SemiGrandCanonicalEnsemble</span><span class="p">(</span>
        <span class="n">calculator</span><span class="o">=</span><span class="n">calculator</span><span class="p">,</span>
        <span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">,</span>
        <span class="n">ensemble_data_write_interval</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">chemical_potentials</span><span class="o">=</span><span class="p">{</span><span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">0</span><span class="p">})</span>

    <span class="c1"># Evolve configuration through the entire composition range</span>
    <span class="k">for</span> <span class="n">dmu</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">):</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">chemical_potentials</span> <span class="o">=</span> <span class="p">{</span><span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">chemical_symbols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">dmu</span><span class="p">}</span>

        <span class="n">mc</span><span class="o">.</span><span class="n">reset_data_container</span><span class="p">()</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">number_of_trial_steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># TODO: change the next line (and the tutorial) once mc.data_container</span>
        <span class="c1"># is writable</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">data_container</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sgc-T{}-dmu{:.3f}.dc&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dmu</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="analyze_monte_carlo.html" class="btn btn-neutral float-right" title="Analyze Monte Carlo simulations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="analyze_ecis.html" class="btn btn-neutral" title="Analyzing ECIs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">Related software</span>
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        
          <dd><a href="https://atomicrex.org/">atomicrex<br>
            <div style="text-indent:1em; font-size:small; color:gray">interatomic potential construction</div>
          </a></dd>
        
          <dd><a href="https://dynasor.materialsmodeling.org/">dynasor<br>
            <div style="text-indent:1em; font-size:small; color:gray">dynamical structure factors from MD</div>
          </a></dd>
        
          <dd><a href="https://hiphive.materialsmodeling.org/">hiphive<br>
            <div style="text-indent:1em; font-size:small; color:gray">anharmonic force constant potentials</div>
          </a></dd>
        
          <dd><a href="https://icet.materialsmodeling.org/">icet<br>
            <div style="text-indent:1em; font-size:small; color:gray">cluster expansions</div>
          </a></dd>
        
          <dd><a href="https://libvdwxc.org/">libvdwxc<br>
            <div style="text-indent:1em; font-size:small; color:gray">library for van-der-Waals functionals</div>
          </a></dd>
        
          <dd><a href="https://storq.materialsmodeling.org/">storq<br>
            <div style="text-indent:1em; font-size:small; color:gray">high-throughput submission system</div>
          </a></dd>
        
          <dd><a href="https://vcsgc-lammps.materialsmodeling.org/">vcsgc-lammps<br>
            <div style="text-indent:1em; font-size:small; color:gray">Monte Carlo simulations with lammps</div>
          </a></dd>
        
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>