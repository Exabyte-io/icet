

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Constructing a cluster expansion &mdash; icet  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/logo.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_styling.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Comparison with target data" href="compare_to_target_data.html" />
    <link rel="prev" title="Basic tutorial" href="index.html" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@MagicMaterials" />
    <meta name="twitter:image" content="https://icet.materialsmodeling.org/_static/logo-small.png" />
    <meta property="og:title" content="icet" />
    <meta property="og:description" content="A Pythonic approach to cluster expansions." />
    <meta property="og:image" content="https://icet.materialsmodeling.org/_static/logo-2x1.png" />


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> icet
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Main</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#building-a-cluster-expansion">Building a cluster expansion</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Constructing a cluster expansion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-preparations">General preparations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparing-a-cluster-space">Preparing a cluster space</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-a-structure-container">Compiling a structure container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training-ce-parameters">Training CE parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finalizing-the-cluster-expansion">Finalizing the cluster expansion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="compare_to_target_data.html">Comparison with target data</a></li>
<li class="toctree-l3"><a class="reference internal" href="enumerate_structures.html">Enumerating structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="analyze_ecis.html">Analyzing ECIs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sampling-a-cluster-expansion">Sampling a cluster expansion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced topics</a></li>
</ul>
<p class="caption"><span class="caption-text">Function reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moduleref_icet/index.html"><strong class="program">icet</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../moduleref_mchammer/index.html"><strong class="program">mchammer</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreref/index.html">Core components</a></li>
</ul>
<p class="caption"><span class="caption-text">Backmatter</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">icet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div style="text-align: right;">
<a href="https://gitlab.com/materials-modeling/icet" target="_blank">gitlab/icet</a>
| <a href="https://materialsmodeling.org/software" target="_blank">materialsmodeling.org/software</a>
| <a href=../genindex.html>index</a>
| <a href=../py-modindex.html>modules</a>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="constructing-a-cluster-expansion">
<span id="index-0"></span><h1>Constructing a cluster expansion<a class="headerlink" href="#constructing-a-cluster-expansion" title="Permalink to this headline">¶</a></h1>
<p>In this step we will construct a cluster expansion using a dataset of Ag-Pd
structures, which have been relaxed using density functional theory
calculations. The construction of such a data set will be discussed in the
advanced section of the tutorial.</p>
<div class="section" id="general-preparations">
<h2>General preparations<a class="headerlink" href="#general-preparations" title="Permalink to this headline">¶</a></h2>
<p>A number of <a class="reference external" href="https://wiki.fysik.dtu.dk/ase">ASE</a> and <strong class="program">icet</strong>
functions are needed in order to set up and train the cluster expansion. Since
the reference data is provided in the form of an <a class="reference external" href="https://wiki.fysik.dtu.dk/ase">ASE</a> database we require the
<a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/db/db.html#ase.db.core.connect" title="(in ASE v)"><code class="xref py py-func docutils literal"><span class="pre">ase.db.connect()</span></code></a> function. Furthermore, the
<strong class="program">icet</strong> classes <a class="reference internal" href="../moduleref_icet/cluster_space.html#icet.ClusterSpace" title="icet.ClusterSpace"><code class="xref py py-class docutils literal"><span class="pre">ClusterSpace</span></code></a>,
<a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a>,
<a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a> and
<a class="reference internal" href="../moduleref_icet/cluster_expansion.html#icet.ClusterExpansion" title="icet.ClusterExpansion"><code class="xref py py-class docutils literal"><span class="pre">ClusterExpansion</span></code></a> are
used, <a class="reference internal" href="../workflow.html#workflow"><span class="std std-ref">in sequence</span></a>, during preparation, compilation and
training of the cluster expansion followed by the extraction of information in
the form of predicted energies from the latter.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># This scripts runs in about 16 seconds on an i7-6700K CPU.</span>

<span class="kn">from</span> <span class="nn">ase.db</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn">icet</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ClusterSpace</span><span class="p">,</span> <span class="n">StructureContainer</span><span class="p">,</span>
                  <span class="n">CrossValidationEstimator</span><span class="p">,</span> <span class="n">ClusterExpansion</span><span class="p">)</span>

</pre></div>
</div>
<p>Then we open a connection to the reference database and use the first structure
in the database as the primitive structure as we happen to have prepared the
database in this way.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;reference_data.db&#39;</span><span class="p">)</span>
<span class="n">prim</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toatoms</span><span class="p">()</span>  <span class="c1"># primitive structure</span>

</pre></div>
</div>
</div>
<div class="section" id="preparing-a-cluster-space">
<h2>Preparing a cluster space<a class="headerlink" href="#preparing-a-cluster-space" title="Permalink to this headline">¶</a></h2>
<p>In order to be able to build a cluster expansion, it is first necessary to
create a <a class="reference internal" href="../moduleref_icet/cluster_space.html#icet.ClusterSpace" title="icet.ClusterSpace"><code class="xref py py-class docutils literal"><span class="pre">ClusterSpace</span></code></a> object based on a prototype
structure. When initiating the former, one must also provide cutoffs and a list
of elements that should be considered.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">cs</span> <span class="o">=</span> <span class="n">ClusterSpace</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">prim</span><span class="p">,</span>
                  <span class="n">cutoffs</span><span class="o">=</span><span class="p">[</span><span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">],</span>
                  <span class="n">chemical_symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="s1">&#39;Pd&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>

</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here, we include <em>all</em> structures from the database with six or less atoms in
the unit cell. This approach has been adopted in this basic tutorial for the
sake of simplicity. In general this is <em>not</em> the preferred approach to
assembling a data set. The role of structure selection is discussed in more
detail in the advanced section of the tutorial.</p>
</div>
<p>As with many other <strong class="program">icet</strong> objects, it is possible to print core
information in a tabular format by simply calling the <a class="reference external" href="https://docs.python.org/3.6/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> function
with the instance of interest as input argument. For the case at hand, the
output should look as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">===============================</span> <span class="n">Cluster</span> <span class="n">Space</span> <span class="o">================================</span>
 <span class="n">chemical</span> <span class="n">species</span><span class="p">:</span> <span class="n">Pd</span> <span class="n">Ag</span>
 <span class="n">cutoffs</span><span class="p">:</span> <span class="mf">8.5000</span> <span class="mf">8.5000</span> <span class="mf">7.5000</span>
 <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">orbits</span><span class="p">:</span> <span class="mi">173</span>
 <span class="n">number</span> <span class="n">of</span> <span class="n">orbits</span> <span class="n">by</span> <span class="n">order</span><span class="p">:</span> <span class="mi">0</span><span class="o">=</span> <span class="mi">1</span>  <span class="mi">1</span><span class="o">=</span> <span class="mi">1</span>  <span class="mi">2</span><span class="o">=</span> <span class="mi">8</span>  <span class="mi">3</span><span class="o">=</span> <span class="mi">50</span>  <span class="mi">4</span><span class="o">=</span> <span class="mi">113</span>
<span class="o">------------------------------------------------------------------------------</span>
<span class="n">index</span> <span class="o">|</span> <span class="n">order</span> <span class="o">|</span>  <span class="n">radius</span>  <span class="o">|</span> <span class="n">multiplicity</span> <span class="o">|</span> <span class="n">orbit_index</span> <span class="o">|</span> <span class="n">multi_component_vector</span>
<span class="o">------------------------------------------------------------------------------</span>
   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>   <span class="o">|</span>   <span class="mf">0.0000</span> <span class="o">|</span>        <span class="mi">1</span>     <span class="o">|</span>      <span class="o">-</span><span class="mi">1</span>
   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">1</span>   <span class="o">|</span>   <span class="mf">0.0000</span> <span class="o">|</span>        <span class="mi">1</span>     <span class="o">|</span>       <span class="mi">0</span>     <span class="o">|</span>          <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="mi">2</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">1.4460</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>       <span class="mi">1</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">3</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.0450</span> <span class="o">|</span>        <span class="mi">3</span>     <span class="o">|</span>       <span class="mi">2</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">4</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.5046</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>       <span class="mi">3</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">5</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.8921</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>       <span class="mi">4</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">6</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.2334</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>       <span class="mi">5</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">7</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">4</span>     <span class="o">|</span>       <span class="mi">6</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">8</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.8258</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>       <span class="mi">7</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
   <span class="mi">9</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">4.0900</span> <span class="o">|</span>        <span class="mi">3</span>     <span class="o">|</span>       <span class="mi">8</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="o">...</span>
 <span class="mi">163</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4222</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">162</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">164</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4327</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">163</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">165</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4642</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">164</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">166</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">2</span>     <span class="o">|</span>     <span class="mi">165</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">167</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>     <span class="mi">166</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">168</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5886</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">167</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">169</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6056</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">168</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">170</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6056</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">169</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">171</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6577</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">170</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 <span class="mi">172</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.8258</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>     <span class="mi">171</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">==============================================================================</span>
</pre></div>
</div>
</div>
<div class="section" id="compiling-a-structure-container">
<h2>Compiling a structure container<a class="headerlink" href="#compiling-a-structure-container" title="Permalink to this headline">¶</a></h2>
<p>Once a <a class="reference internal" href="../moduleref_icet/cluster_space.html#icet.ClusterSpace" title="icet.ClusterSpace"><code class="xref py py-class docutils literal"><span class="pre">ClusterSpace</span></code></a> has been prepared, the next
step is to compile a <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a>. To
this end, we first initialize an empty <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a> and then add the structures from the database
prepared previously including for each structure the mixing energy in the
property dictionary.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="n">StructureContainer</span><span class="p">(</span><span class="n">cluster_space</span><span class="o">=</span><span class="n">cs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;natoms&lt;=6&#39;</span><span class="p">):</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_structure</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">toatoms</span><span class="p">(),</span>
                     <span class="n">user_tag</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                     <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mixing_energy&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">mixing_energy</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>

</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While here we add only <em>one</em> property, the <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a> allows the addition of <em>several</em> properties. This
can be useful e.g., when constructing (and sampling) CEs for a couple of
different properties.</p>
</div>
<p>By calling the <a class="reference external" href="https://docs.python.org/3.6/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> function with the <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a> as input argument, one obtains the following
result:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">==========================</span> <span class="n">Structure</span> <span class="n">Container</span> <span class="o">==========================</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">structures</span><span class="p">:</span> <span class="mi">137</span>
<span class="o">-------------------------------------------------------------------------</span>
<span class="n">index</span> <span class="o">|</span>       <span class="n">user_tag</span>        <span class="o">|</span> <span class="n">natoms</span> <span class="o">|</span> <span class="n">chemical</span> <span class="n">formula</span> <span class="o">|</span> <span class="n">mixing</span><span class="o">-</span><span class="n">energy</span>
<span class="o">-------------------------------------------------------------------------</span>
   <span class="mi">0</span>  <span class="o">|</span> <span class="n">Ag</span>                    <span class="o">|</span>     <span class="mi">1</span>  <span class="o">|</span> <span class="n">Ag</span>               <span class="o">|</span>      <span class="mf">0.000</span>
   <span class="mi">1</span>  <span class="o">|</span> <span class="n">Pd</span>                    <span class="o">|</span>     <span class="mi">1</span>  <span class="o">|</span> <span class="n">Pd</span>               <span class="o">|</span>      <span class="mf">0.000</span>
   <span class="mi">2</span>  <span class="o">|</span> <span class="n">AgPd_0002</span>             <span class="o">|</span>     <span class="mi">2</span>  <span class="o">|</span> <span class="n">AgPd</span>             <span class="o">|</span>     <span class="o">-</span><span class="mf">0.040</span>
   <span class="mi">3</span>  <span class="o">|</span> <span class="n">AgPd_0003</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">AgPd2</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.029</span>
   <span class="mi">4</span>  <span class="o">|</span> <span class="n">AgPd_0004</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">Ag2Pd</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.049</span>
   <span class="mi">5</span>  <span class="o">|</span> <span class="n">AgPd_0005</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">AgPd2</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.018</span>
   <span class="mi">6</span>  <span class="o">|</span> <span class="n">AgPd_0006</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">Ag2Pd</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.056</span>
   <span class="mi">7</span>  <span class="o">|</span> <span class="n">AgPd_0007</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">AgPd2</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.030</span>
   <span class="mi">8</span>  <span class="o">|</span> <span class="n">AgPd_0008</span>             <span class="o">|</span>     <span class="mi">3</span>  <span class="o">|</span> <span class="n">Ag2Pd</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.048</span>
   <span class="mi">9</span>  <span class="o">|</span> <span class="n">AgPd_0009</span>             <span class="o">|</span>     <span class="mi">4</span>  <span class="o">|</span> <span class="n">AgPd3</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.017</span>
 <span class="o">...</span>
 <span class="mi">127</span>  <span class="o">|</span> <span class="n">AgPd_0127</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag5Pd</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.032</span>
 <span class="mi">128</span>  <span class="o">|</span> <span class="n">AgPd_0128</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">AgPd5</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.012</span>
 <span class="mi">129</span>  <span class="o">|</span> <span class="n">AgPd_0129</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag2Pd4</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.026</span>
 <span class="mi">130</span>  <span class="o">|</span> <span class="n">AgPd_0130</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag2Pd4</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.024</span>
 <span class="mi">131</span>  <span class="o">|</span> <span class="n">AgPd_0131</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag4Pd2</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.059</span>
 <span class="mi">132</span>  <span class="o">|</span> <span class="n">AgPd_0132</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag4Pd2</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.054</span>
 <span class="mi">133</span>  <span class="o">|</span> <span class="n">AgPd_0133</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag3Pd3</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.046</span>
 <span class="mi">134</span>  <span class="o">|</span> <span class="n">AgPd_0134</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag3Pd3</span>           <span class="o">|</span>     <span class="o">-</span><span class="mf">0.048</span>
 <span class="mi">135</span>  <span class="o">|</span> <span class="n">AgPd_0135</span>             <span class="o">|</span>     <span class="mi">6</span>  <span class="o">|</span> <span class="n">Ag5Pd</span>            <span class="o">|</span>     <span class="o">-</span><span class="mf">0.040</span>
 <span class="mi">136</span>  <span class="o">|</span> <span class="n">AgPd_0001</span>             <span class="o">|</span>     <span class="mi">2</span>  <span class="o">|</span> <span class="n">AgPd</span>             <span class="o">|</span>     <span class="o">-</span><span class="mf">0.063</span>
<span class="o">=========================================================================</span>
</pre></div>
</div>
</div>
<div class="section" id="training-ce-parameters">
<h2>Training CE parameters<a class="headerlink" href="#training-ce-parameters" title="Permalink to this headline">¶</a></h2>
<p>Since the <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a> object created
in the previous section, contains all the information required for constructing
a cluster expansion, the next step is to train the parameters, i.e. to fit the
<em>effective cluster interactions</em> (ECIs) using the target data. More precisely,
the goal is to achieve the best possible agreement with set of training
structures, which represent a subset of all the structures in the
<a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a>. In practice, this is a
two step process that involves the initiation of an optimizer object (here a
<a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a>) with a list
of target properties produced by the <a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer.get_fit_data" title="icet.StructureContainer.get_fit_data"><code class="xref py py-func docutils literal"><span class="pre">get_fit_data()</span></code></a> method of the
<a class="reference internal" href="../moduleref_icet/structure_container.html#icet.StructureContainer" title="icet.StructureContainer"><code class="xref py py-class docutils literal"><span class="pre">StructureContainer</span></code></a> as input argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="o">=</span> <span class="n">CrossValidationEstimator</span><span class="p">(</span><span class="n">fit_data</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">get_fit_data</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;mixing_energy&#39;</span><span class="p">),</span>
                               <span class="n">fit_method</span><span class="o">=</span><span class="s1">&#39;lasso&#39;</span><span class="p">)</span>
<span class="n">opt</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="n">opt</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

</pre></div>
</div>
<p>The <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a> optimizer
used here is intended to provide a reliable estimate for the cross validation
(<a class="reference internal" href="../glossary.html#term-cv"><span class="xref std std-term">CV</span></a>) score. This is achieved by calling the <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator.validate" title="icet.CrossValidationEstimator.validate"><code class="xref py py-func docutils literal"><span class="pre">validate</span></code></a> method. With the current (default)
settings the <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a>
then randomly splits the available data into a training and a validation set.
The effective cluster interactions (<a class="reference internal" href="../glossary.html#term-ecis"><span class="xref std std-term">ECIs</span></a>) are then found using the
<a class="reference internal" href="../glossary.html#term-lasso"><span class="xref std std-term">LASSO</span></a> method (<code class="docutils literal"><span class="pre">fit_method</span></code>). This procedure is repeated 10 times
(<code class="docutils literal"><span class="pre">number_of_splits</span></code>). (<em>You will likely see a few “Convergence errors” when
executing this command. For the present purpose these can be ignored.</em>)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="../glossary.html#term-lasso"><span class="xref std std-term">LASSO</span></a> method is particular suitable for (strongly)
under-determined systems while the present case is only “slightly”
under-determined. The performance and application area of different
optimization algorithms are analyzed and compared in the advanced tutorial
section.</p>
</div>
<p>The “final” CE is ultimately constructed using <em>all</em> available data by calling
the <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator.train" title="icet.CrossValidationEstimator.train"><code class="xref py py-func docutils literal"><span class="pre">train</span></code></a> method. Once it is
finished, the results can be displayed by providing the
<a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a> object to the
<a class="reference external" href="https://docs.python.org/3.6/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> function, which gives the output shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">==============</span> <span class="n">CrossValidationEstimator</span> <span class="o">==============</span>
<span class="n">alpha_optimal</span>                  <span class="p">:</span> <span class="mf">4.524343e-05</span>
<span class="n">fit_method</span>                     <span class="p">:</span> <span class="n">lasso</span>
<span class="n">number_of_nonzero_parameters</span>   <span class="p">:</span> <span class="mi">54</span>
<span class="n">number_of_parameters</span>           <span class="p">:</span> <span class="mi">173</span>
<span class="n">number_of_splits</span>               <span class="p">:</span> <span class="mi">10</span>
<span class="n">number_of_target_values</span>        <span class="p">:</span> <span class="mi">137</span>
<span class="n">rmse_train</span>                     <span class="p">:</span> <span class="mf">0.00121032</span>
<span class="n">rmse_train_final</span>               <span class="p">:</span> <span class="mf">0.001247321</span>
<span class="n">rmse_validation</span>                <span class="p">:</span> <span class="mf">0.002371993</span>
<span class="n">standardize</span>                    <span class="p">:</span> <span class="bp">True</span>
<span class="n">validation_method</span>              <span class="p">:</span> <span class="n">k</span><span class="o">-</span><span class="n">fold</span>
<span class="o">======================================================</span>
</pre></div>
</div>
<p>We have thus constructed a CE with an average root mean square error (RMSE,
<code class="docutils literal"><span class="pre">rmse_validation</span></code>) for the validation set of only 2.4 meV/atom. The original
cluster space included 173 parameters (<code class="docutils literal"><span class="pre">number_of_parameters</span></code>), 54 of which
are non-zero (<code class="docutils literal"><span class="pre">number_of_nonzero_parameters</span></code>) in the final CE. The efficiency
of the <a class="reference internal" href="../glossary.html#term-lasso"><span class="xref std std-term">LASSO</span></a> method for finding sparse solutions is evident from the
number of non-zero parameters (54) being much smaller than the total number of
parameters (173).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here we have used the <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.CrossValidationEstimator" title="icet.CrossValidationEstimator"><code class="xref py py-class docutils literal"><span class="pre">CrossValidationEstimator</span></code></a> as it is probably the most common optimizer
used in practice. There are, however, <a class="reference internal" href="../moduleref_icet/optimizers.html#optimizers"><span class="std std-ref">other optimizers</span></a>
that can be highly useful for certain applications.</p>
</div>
</div>
<div class="section" id="finalizing-the-cluster-expansion">
<h2>Finalizing the cluster expansion<a class="headerlink" href="#finalizing-the-cluster-expansion" title="Permalink to this headline">¶</a></h2>
<p>At this point, the task of constructing the cluster expansion is almost
complete. The only step that remains is to tie the parameter values obtained
from the optimization to the cluster space. This is achieved through the
initiation of a <a class="reference internal" href="../moduleref_icet/cluster_expansion.html#icet.ClusterExpansion" title="icet.ClusterExpansion"><code class="xref py py-class docutils literal"><span class="pre">ClusterExpansion</span></code></a> object using
the previously created <a class="reference internal" href="../moduleref_icet/cluster_space.html#icet.ClusterSpace" title="icet.ClusterSpace"><code class="xref py py-class docutils literal"><span class="pre">ClusterSpace</span></code></a> instance and
the list of parameters, available via the <a class="reference internal" href="../moduleref_icet/optimizers.html#icet.Optimizer.parameters" title="icet.Optimizer.parameters"><code class="xref py py-class docutils literal"><span class="pre">parameters</span></code></a> attribute of the optimizer, as input arguments.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ce</span> <span class="o">=</span> <span class="n">ClusterExpansion</span><span class="p">(</span><span class="n">cluster_space</span><span class="o">=</span><span class="n">cs</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">ce</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;mixing_energy.ce&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ce</span><span class="p">)</span>
</pre></div>
</div>
<p>Information regarding the parameters and associated cluster space
can be displayed by using the <a class="reference external" href="https://docs.python.org/3.6/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> function with the
<a class="reference internal" href="../moduleref_icet/cluster_expansion.html#icet.ClusterExpansion" title="icet.ClusterExpansion"><code class="xref py py-class docutils literal"><span class="pre">ClusterExpansion</span></code></a> object as input argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">===================================</span> <span class="n">Cluster</span> <span class="n">Expansion</span> <span class="o">====================================</span>
 <span class="n">chemical</span> <span class="n">species</span><span class="p">:</span> <span class="n">Pd</span> <span class="n">Ag</span>
 <span class="n">cutoffs</span><span class="p">:</span> <span class="mf">8.5000</span> <span class="mf">8.5000</span> <span class="mf">7.5000</span>
 <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">orbits</span><span class="p">:</span> <span class="mi">173</span>
 <span class="n">number</span> <span class="n">of</span> <span class="n">orbits</span> <span class="n">by</span> <span class="n">order</span><span class="p">:</span> <span class="mi">0</span><span class="o">=</span> <span class="mi">1</span>  <span class="mi">1</span><span class="o">=</span> <span class="mi">1</span>  <span class="mi">2</span><span class="o">=</span> <span class="mi">8</span>  <span class="mi">3</span><span class="o">=</span> <span class="mi">50</span>  <span class="mi">4</span><span class="o">=</span> <span class="mi">113</span>
<span class="o">------------------------------------------------------------------------------------------</span>
<span class="n">index</span> <span class="o">|</span> <span class="n">order</span> <span class="o">|</span>  <span class="n">radius</span>  <span class="o">|</span> <span class="n">multiplicity</span> <span class="o">|</span> <span class="n">orbit_index</span> <span class="o">|</span> <span class="n">multi_component_vector</span> <span class="o">|</span>    <span class="n">ECI</span>
<span class="o">------------------------------------------------------------------------------------------</span>
   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>   <span class="o">|</span>   <span class="mf">0.0000</span> <span class="o">|</span>        <span class="mi">1</span>     <span class="o">|</span>      <span class="o">-</span><span class="mi">1</span>     <span class="o">|</span>           <span class="o">.</span>            <span class="o">|</span>   <span class="o">-</span><span class="mf">0.0438</span>
   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">1</span>   <span class="o">|</span>   <span class="mf">0.0000</span> <span class="o">|</span>        <span class="mi">1</span>     <span class="o">|</span>       <span class="mi">0</span>     <span class="o">|</span>          <span class="p">[</span><span class="mi">0</span><span class="p">]</span>           <span class="o">|</span>   <span class="o">-</span><span class="mf">0.0348</span>
   <span class="mi">2</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">1.4460</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>       <span class="mi">1</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>     <span class="mf">0.024</span>
   <span class="mi">3</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.0450</span> <span class="o">|</span>        <span class="mi">3</span>     <span class="o">|</span>       <span class="mi">2</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>     <span class="mf">0.014</span>
   <span class="mi">4</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.5046</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>       <span class="mi">3</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>    <span class="mf">0.0174</span>
   <span class="mi">5</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">2.8921</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>       <span class="mi">4</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>         <span class="mi">0</span>
   <span class="mi">6</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.2334</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>       <span class="mi">5</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>         <span class="mi">0</span>
   <span class="mi">7</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">4</span>     <span class="o">|</span>       <span class="mi">6</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>   <span class="mf">0.00258</span>
   <span class="mi">8</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">3.8258</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>       <span class="mi">7</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>  <span class="o">-</span><span class="mf">0.00214</span>
   <span class="mi">9</span>  <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mf">4.0900</span> <span class="o">|</span>        <span class="mi">3</span>     <span class="o">|</span>       <span class="mi">8</span>     <span class="o">|</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>         <span class="o">|</span>        <span class="o">-</span><span class="mi">0</span>
 <span class="o">...</span>
 <span class="mi">163</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4222</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">162</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">8.84e-05</span>
 <span class="mi">164</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4327</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">163</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>        <span class="o">-</span><span class="mi">0</span>
 <span class="mi">165</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.4642</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">164</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>  <span class="mf">0.000643</span>
 <span class="mi">166</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">2</span>     <span class="o">|</span>     <span class="mi">165</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>        <span class="o">-</span><span class="mi">0</span>
 <span class="mi">167</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5420</span> <span class="o">|</span>        <span class="mi">6</span>     <span class="o">|</span>     <span class="mi">166</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">-</span><span class="mf">0.00109</span>
 <span class="mi">168</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.5886</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">167</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">-</span><span class="mf">0.00143</span>
 <span class="mi">169</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6056</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">168</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>         <span class="mi">0</span>
 <span class="mi">170</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6056</span> <span class="o">|</span>       <span class="mi">48</span>     <span class="o">|</span>     <span class="mi">169</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.000859</span>
 <span class="mi">171</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.6577</span> <span class="o">|</span>       <span class="mi">24</span>     <span class="o">|</span>     <span class="mi">170</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.000354</span>
 <span class="mi">172</span>  <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>   <span class="mf">3.8258</span> <span class="o">|</span>       <span class="mi">12</span>     <span class="o">|</span>     <span class="mi">171</span>     <span class="o">|</span>      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>         <span class="mi">0</span>
<span class="o">==========================================================================================</span>
</pre></div>
</div>
<p>Finally, the CE is written to file in order to be reused in the following steps of the
tutorial.</p>
</div>
<div class="section" id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<div class="toggle docutils container">
<div class="header docutils container">
The complete source code is available in
<code class="docutils literal"><span class="pre">tutorial/basic/1_construct_cluster_expansion.py</span></code></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># This scripts runs in about 16 seconds on an i7-6700K CPU.</span>

<span class="kn">from</span> <span class="nn">ase.db</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn">icet</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ClusterSpace</span><span class="p">,</span> <span class="n">StructureContainer</span><span class="p">,</span>
                  <span class="n">CrossValidationEstimator</span><span class="p">,</span> <span class="n">ClusterExpansion</span><span class="p">)</span>

<span class="c1"># step 1: Basic setup</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;reference_data.db&#39;</span><span class="p">)</span>
<span class="n">prim</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toatoms</span><span class="p">()</span>  <span class="c1"># primitive structure</span>

<span class="c1"># step 2: Set up the basic structure and a cluster space</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ClusterSpace</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">prim</span><span class="p">,</span>
                  <span class="n">cutoffs</span><span class="o">=</span><span class="p">[</span><span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">],</span>
                  <span class="n">chemical_symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="s1">&#39;Pd&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>

<span class="c1"># step 3: Parse the input structures and set up a structure container</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">StructureContainer</span><span class="p">(</span><span class="n">cluster_space</span><span class="o">=</span><span class="n">cs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;natoms&lt;=6&#39;</span><span class="p">):</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_structure</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">toatoms</span><span class="p">(),</span>
                     <span class="n">user_tag</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                     <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mixing_energy&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">mixing_energy</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>

<span class="c1"># step 4: Train parameters</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">CrossValidationEstimator</span><span class="p">(</span><span class="n">fit_data</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">get_fit_data</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;mixing_energy&#39;</span><span class="p">),</span>
                               <span class="n">fit_method</span><span class="o">=</span><span class="s1">&#39;lasso&#39;</span><span class="p">)</span>
<span class="n">opt</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="n">opt</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

<span class="c1"># step 5: Construct cluster expansion and write it to file</span>
<span class="n">ce</span> <span class="o">=</span> <span class="n">ClusterExpansion</span><span class="p">(</span><span class="n">cluster_space</span><span class="o">=</span><span class="n">cs</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">ce</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;mixing_energy.ce&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ce</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="compare_to_target_data.html" class="btn btn-neutral float-right" title="Comparison with target data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Basic tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">Related software</span>
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        
          <dd><a href="https://atomicrex.org/">atomicrex<br>
            <div style="text-indent:1em; font-size:small; color:gray">interatomic potential construction</div>
          </a></dd>
        
          <dd><a href="https://dynasor.materialsmodeling.org/">dynasor<br>
            <div style="text-indent:1em; font-size:small; color:gray">dynamical structure factors from MD</div>
          </a></dd>
        
          <dd><a href="https://hiphive.materialsmodeling.org/">hiphive<br>
            <div style="text-indent:1em; font-size:small; color:gray">anharmonic force constant potentials</div>
          </a></dd>
        
          <dd><a href="https://icet.materialsmodeling.org/">icet<br>
            <div style="text-indent:1em; font-size:small; color:gray">cluster expansions</div>
          </a></dd>
        
          <dd><a href="https://libvdwxc.org/">libvdwxc<br>
            <div style="text-indent:1em; font-size:small; color:gray">library for van-der-Waals functionals</div>
          </a></dd>
        
          <dd><a href="https://storq.materialsmodeling.org/">storq<br>
            <div style="text-indent:1em; font-size:small; color:gray">high-throughput submission system</div>
          </a></dd>
        
          <dd><a href="https://vcsgc-lammps.materialsmodeling.org/">vcsgc-lammps<br>
            <div style="text-indent:1em; font-size:small; color:gray">Monte Carlo simulations with lammps</div>
          </a></dd>
        
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>